## **C++ 大型项目设计解耦技巧**

### **C++缺陷设计简述**
- **未预见到的客户需求可能会使我们在增强系统时考虑不周，从而导致不必要的循环依赖**
    1. **允许两个组件通过#include指令彼此‘知道’隐含了循环物理依赖。**
    2. **例子：Rectangle 和 window 两个类对象，有截然不同的性能特征，但包含着相同的逻辑信息。客户程序偶尔需要在这两类盒子之间转换**
        ```sh
        # 实现互相转换的几种做法 
        # A. 两个类的头文件引入对方的头文件。会产生循环物理依赖。- 不可层次化
        # B. 两个类的C文件引入对方的头文件。会产生非循环物理依赖。- 可层次化【减少编译连接时的性能时间，提高模块的独立性】
        # C. 支配：选一个组件提它的层次，让其依赖另一个组件。- 只有一个组件可以独立使用，高层次组件无法独立使用 【片面】
        # D. 升级：在两个组件之上设置一个新组件，该组件位于它们之上一个层次，并且包含它们。
        #    重点：同层次的组件是循环依赖的，那么就有可能把互相依赖的功能从每一个组件升级为潜在的新的更高层次的组件(依赖于每一个初始的组件)的静态成员。P185
        ```
- **相关抽象接口中的内存耦合使他们更抗拒层次分解。**
    1. 为了避免出现封装缺口和由于远距离友元关系导致的缺乏模块性，可能有必要将若干可层次化的类归入一个单一的组件内。

### **C++物理设计解耦技巧**
- **一个不小心的功能增强使得组件间出现了依赖**
    1. **升级： 把相互依赖的功能推到物理层次结构的更高层来消除循环依赖。**
        ```sh
        # 实现：将底层子模块，组件之间的转换或者工厂关系通过静态成员结构的方式提取出来有利于编译，链接，分层测试和组件解耦
        ```
    2. **降级: 把相互依赖的功能推到物理层次结构的低层来消除循环依赖。**
        ```sh
        # 方法1：可以对功能重新打包，这样可以恢复单向依赖。【这些组件的客户程序可能受影响 - p172】
        # 方法2：将两个或多个静态工具中产生依赖的部分抽成一个独立的组件。而这些组件通过特殊方式（实现继承等）与该核心组件建立链接。
        ```














