## MySql主从同步 ##

### 数据库主从架构是最后的选择 ###
- 数据库进行主从架构的设置本身是有成本的
    1. 先需要考虑的应该是如何优化 SQL 和索引，简单有效。
    2. 其次采用缓存的策略。比如：通过 Redis 高性能的优势将热点数据保存在内存数据库中，提升读取的效率。
    3. 最后才是对数据库采用主从架构，进行读写分离。

### 数据库主从架构简介 ###  
- 读写分离：主库负责写，当主库出现写锁的时候，不会影响到从库进行 SELECT 的读取（互联网读多写少的特性）
- 数据备份：通过主从复制将主库上的数据复制到了从库上，相当于是一种热备份机制
- 高可用性：主从切换；一年99.999%时间都可用 <==> 一年服务只能停 5.26分钟

### 主从同步实现原理 ###
- 主从同步的原理就是基于 Binlog 进行数据同步的
- 在主从复制过程中，会基于 3 个线程来操作，一个主库线程，两个从库线程
- 二进制日志转储线程（Binlog dump thread）是一个主库线程
    1. 当从库线程连接的时候，主库可以将二进制日志发送给从库
    2. 当主库读取事件的时候，会在 Binlog 上加锁，读取完成之后，再将锁释放掉

- 从库 I/O 线程会连接到主库，向主库发送请求更新 Binlog
    1. 从库的 I/O 线程就可以读取到主库日志转储线程发送的 Binlog 更新部分，拷贝到本地形成中继日志（Relay log）。
    2. 从库 SQL 线程会读取从库中的中继日志，并且执行日志中的事件，从而保持同步。

### 如何解决主从数据同步的一致性问题 ###
- 网络传输的过程中就一定会存在延迟（比如 500ms），可能造成用户在从库上读取的数据不是最新的数据。
- 异步模式 [waiting]
- 半同步复制 [waiting]
- 组复制 [waiting]