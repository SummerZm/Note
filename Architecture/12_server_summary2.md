## **服务器后台架构设计2**

### **前言**
#### **服务器后台架构的组成**
- **操作系统**
- **编程语言**
- **负载均衡（Load Balance）**
- **数据库或其他形式的存储（DB/Storage）**
- **业务架构**

### **服务器业务架构(必然是领域性的，与你所从事的行业息息相关)**
#### **网络协议**
- **RESTful (Representational State Transfer)**
```sh
# 【A. RESTful 的特征】
#   第一：
#   客户端和服务器之间的交互在请求之间是 “无状态” 的。这里的无状态更严谨的说法是 “无会话（Session）” 的。
#   从客户端到服务器的每个请求，都必须包含理解请求所必需的完整信息。服务器可以在请求之间的任何时间点重启，客户端不会得到通知。
#
#   第二：
#   统一的表现规范，也就是 Representational 一词传递的意思。
#   它认为，所有网络 API 请求都应该统一抽象为对某种资源 URI 的 GET、PUT、POST、DELETE 操作。
```

```sh
# 【B. MVC 架构中的 Controll 层】
#   在桌面程序的 MVC 架构中，Model 层提供核心业务，它不存在 “临时状态”，每一个对外提供的接口（API）都完成一项完整的业务。
#   View 层提供呈现，和我们的话题关联不大，这里不展开来讲。Controller 层负责把 “用户交互事件” 翻译成 Model 层的业务 API。
#   在 Controller 层往往存在 “临时状态” 的，它需要把多个连续的 “用户交互事件” 组装起来完成一项业务。
```

```sh
# 【C.其他网络协议框架】
#   文本协议：基于 XML 的有 SOAP（简易对象访问协议）、WSDL（Web 服务描述语言）等。
#   二进制的协议：Facebook 早年搞了个 thrift，不过 Facebook 自己应该不怎么用了。
#   二进制的协议：Google 也搞了个 protobuf 协议，并且基于 protobuf 搞了一个 grpc 框架。
#   GraphQL 推崇企业在有多个业务的时候，不要发布很多套 RESTful API，而是基于一个统一的数据图，并通过 GraphQL 协议暴露给开发者。
```

#### **授权（Authorization）**
- **一种是基于 Token [面向终端用户]**
    ```sh
    # 当前推荐的 Token 授权标准是 OAuth 2.0
    # OAuth 2.0 的优势是对外提供 Open API，而不仅仅局限于自己的 App 用。
    # OAuth 2.0 能够让我们的客户不用向第三方应用去暴露自己的用户隐私（比如用户名和密码）的前提下，调用 API 来使用我们的服务。
    # 
    # 我们更多要考虑的是如何构建业务无关的用户帐号体系和授权系统。它们隶属于通用的帐号与授权子系统，可以做到与业务无关。
    ```
- **一种是基于 AK/SK [面向企业用户]** 
    ```sh
    # AK 是密钥提示（keyHint）
    # SK 是数字签名的密钥（key）
    ```

#### **RPC 框架**
- 如果业务 API 选择了基于 protobuf，那么 grpc 框架是个不错的选择。
- 对于 RESTful API，七牛云对外开源了一套非常精简的 restrpc 服务器框架 https://github.com/qiniu/http

#### **单元测试**
- 如何在不用写业务 API 的 Client SDK 的情况下，能够保持业务友好的方式来写测试案例。https://github.com/qiniu/httptest
- qiniutest 工具只是在 httptest 基础上作了少量的扩展，其 Github 主页为：https://github.com/qiniu/qiniutest

### **服务端开发和桌面端开发各自有各自的复杂性**
- 服务端开发，难在基础软件很多，对程序员和架构师的知识面和理解深度都有较高的要求。但从业务复杂性来说，服务端的业务逻辑相对简单。
- 桌面端开发则相反，它的难点在于用户交互逻辑复杂，代码量大，业务架构的复杂性高。
