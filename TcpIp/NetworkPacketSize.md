## **以太网上各层次网络数据包大小**
> **以太网EthernetII最大的数据帧是1518Bytes** 

### A. 以太帧简介
- 以太网帧的帧头（DMAC目的MAC地址48bits=6Bytes+SMAC源MAC地址48bits=6Bytes+Type域2Bytes）
- 帧尾CRC校验部分4Bytes
- Data域最大就只能有1500Bytes，这个值我们就把它称之为MTU。

### B. 在链路层，由以太网的物理特性决定了数据帧的长度为 
- 帧头[以太网头部]： 14 bytes
- 帧数据[MTU]： 46～1500 bytes
- 帧尾[以太网尾部]：4 bytes

### C.【网络层】
- 因为IP包的首部要占用20字节: MTU为1500－20＝1480

### D.【传输层】
- UDP包的首部要占用8字节，MTU为1480－8＝1472；
    ```sh
    # UDP 包的大小就应该是 1500 - IP头(20) - UDP头(8) = 1472(Bytes)
    # 当我们的UDP包中的数据多于MTU(1472)时，发送方的IP层需要分片fragmentation进行传输，
    # 而在接收方IP层则需要进行数据报重组，由于UDP是不可靠的传输协议，
    # 如果分片丢失导致重组失败，将导致UDP数据包被丢弃。 　　
    # 从上面的分析来看，在普通的局域网环境下，UDP的数据最大为1472字节最好(避免分片重组)

    # 在网络编程中，Internet中的路由器可能有设置成不同的值(小于默认值)，
    # Internet上的标准MTU值为576，所以Internet的UDP编程时数据长度最好在576－20－8＝548字节以内。

    # TCP 包的大小就应该是 1500 - IP头(20) - TCP头(20) = 1460 (Bytes)
    ```
- PPPoE 所谓PPPoE就是在以太网上面跑“PPP”
    ```sh
    # 随着宽带接入（这种宽带接入一般为Cable Modem或者xDSL或者以太网的接入）
    # 以太网缺乏认证计费机制而传统运营商是通过PPP协议来对拨号等接入服务进行认证计费的，所以引入PPPoE
    # PPPoE导致MTU变小了。以太网的MTU是1500，再减去PPP的包头包尾的开销（8Bytes），就变成1492。
    # 不过目前大多数的路由设备的MTU都为1500。
    ```

### E. TCP、UDP数据包最小值的确定
- 在用UDP局域网通信时，经常发生“Hello World”来进行测试，但是“Hello World”并不满足最小有效数据(64-46)的要求.
- 为什么小于18个字节，对方仍然可用收到呢？
- 因为在链路层的MAC子层中会进行数据补齐，不足18个字节的用0补齐。
- 当服务器在公网，客户端在内网，发生小于18个字节的数据，就会出现接收端收不到数据的情况。

- 以太网EthernetII规定，以太网帧数据域部分最小为46字节，也就是以太网帧最小是6＋6＋2＋46＋4＝64。除去4个字节的FCS，因此，抓包时就是60字节。
- 当数据字段的长度小于46字节时，MAC子层就会在数据字段的后面填充以满足数据帧长不小于64字节。
- 由于填充数据是由MAC子层负责，也就是设备驱动程序。不同的抓包程序和设备驱动程序所处的优先层次可能不同。
- 抓包程序的优先级可能比设备驱动程序更高，也就是说，我们的抓包程序可能在设备驱动程序还没有填充不到64字节的帧的时候，抓包程序已经捕获了数据。
- 因此不同的抓包工具抓到的数据帧的大小可能不同。
- 分别用wireshark和sniffer抓包的结果，对于TCP 的ACK确认帧的大小一个是54字节，一个是60字节，wireshark抓取时没有填充数据段，sniffer抓取时有填充数据段。

### F. 实际应用
- 用UDP协议发送时，用sendto函数最大能发送数据的长度为：65535- IP头(20) - UDP头(8)＝65507字节。
- 用sendto函数发送数据时，如果发送数据长度大于该值，则函数会返回错误。  

[相关链接](https://blog.csdn.net/caoshangpa/article/details/51530685)

