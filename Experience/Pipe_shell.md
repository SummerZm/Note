## **Linux shell 管道命令解析**

### 管道 | 的作用：将上一个命令的标准输入和下一个命令的标准输出连接起来
1. tar -cf - /work/projects/test : 将要压缩的文件内容给送到标准输出。 【输入】
2. | pv -ns $(du -sb /work/projects/test ：获取要压缩的文件的总大小，再结合管道的标准输入数据进行计量，最后输入的数据无损的传给标准输出【透传】。
3. | gzip > /work/projects/test.tar.gz：对管道的标准输入的数据，进行压缩，生成test.tar.gz文件 【压缩】
4. | xargs -I % sh -c 'echo %; echo % > progress;'：对管道的标准输入的数据进行逐行处理，打印到终端并写入指定文件 【数据格式化处理】
    ```sh
    # 注意点：
    # A. pv -n : 要使用相应的参数。例如: -n ; 才会把计量的信息输入到标准出错；否则，由于pv的输入输出都被透传，计量信息可能会使用未知的描述符输出，导致我们没法获取。
    # B. 2>&1：基于A情况，将标准出错的计量信息重定向到标准输出，成为下一节管道xargs的输入。
    # C. xargs: 在这个地方的作用是将多行输入，转成单行输入，并以覆盖写的形式更新进 progress 文件(即：文件内容只存当前进度数值)。 

    # 背景知识：
    # 1. 我们看到的终端显示的内容并不只是自来标准输出；可以是来自标准输入/输出/出错或者其他未知的文件描述符，只要我们将描述符和终端显示设备（通常是显示器）关联起来就可以
    # 2. 基于1中的原因，在终端上看到进度信息的输出；我们并没法确定输出的源头是标准输出/错误/其他文件描述符；故而要查看pv的工具手册看是否支持指定进度信息的输出源头
    # 3. 查文档得知 pv -n 这参数组合会把进度信息送到标准出错；于是有了后面的   2>&1

    # 整个命令: 
    (\
    tar -cf - /work/projects/test |\
    pv -ns $(du -sb /work/projects/test | awk '{print $1}') |\
    gzip > test.tar.gz.1\
    )\
    2>&1 |\
     xargs -I % sh -c 'echo %; echo % > progress;'
    ```



